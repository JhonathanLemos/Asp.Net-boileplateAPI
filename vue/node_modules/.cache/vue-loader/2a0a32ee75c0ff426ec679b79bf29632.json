{"remainingRequest":"C:\\Users\\lemos\\OneDrive\\Documentos\\My Web Sites\\7.3.0\\vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\lemos\\OneDrive\\Documentos\\My Web Sites\\7.3.0\\vue\\src\\views\\viagensNavios\\modalRelacionarProformas.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\lemos\\OneDrive\\Documentos\\My Web Sites\\7.3.0\\vue\\src\\views\\viagensNavios\\modalRelacionarProformas.vue","mtime":1680609356675},{"path":"C:\\Users\\lemos\\OneDrive\\Documentos\\My Web Sites\\7.3.0\\vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1683229777571},{"path":"C:\\Users\\lemos\\OneDrive\\Documentos\\My Web Sites\\7.3.0\\vue\\node_modules\\vue-loader\\lib\\index.js","mtime":1683229780390}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgeyBjcmVhdGVOYW1lc3BhY2VkSGVscGVycyB9IGZyb20gJ3Z1ZXgnDQppbXBvcnQgQXV0b0NvbXBsZXRlRmlsdGVyQXN5bmMgZnJvbSAnQC9jb21wb25lbnRzL0F1dG9Db21wbGV0ZUZpbHRlckFzeW5jJw0KaW1wb3J0IHZhbGlkYXRpb25SdWxlcyBmcm9tICdAL21peGlucy92YWxpZGF0aW9uUnVsZXMuanMnDQoNCmNvbnN0IG1vZHVsZVByb2Zvcm1hcyA9IGNyZWF0ZU5hbWVzcGFjZWRIZWxwZXJzKCdNb2R1bGVQcm9mb3JtYXMnKQ0KY29uc3QgbW9kdWxlUGFyYWRhcyA9IGNyZWF0ZU5hbWVzcGFjZWRIZWxwZXJzKCdNb2R1bGVQYXJhZGFzSW50ZXJtZWRpYXJpYXMnKQ0KZXhwb3J0IGRlZmF1bHQgew0KICBwcm9wczogWydkaXNwbGF5JywgJ2luZGV4JywgJ2Vycm9yJywgJ2Rpc2FibGVCdXR0b25SZWxhY2lvbmFyJ10sDQogIGNvbXBvbmVudHM6IHsNCiAgICBBdXRvQ29tcGxldGVGaWx0ZXJBc3luYywNCiAgfSwNCg0KICBkYXRhOiAoKSA9PiAoew0KICAgIGxvYWRpbmdFbWJhcnF1ZXM6IGZhbHNlLA0KICAgIGJvYXJkaW5nR3JvdXA6IG51bGwsDQogICAgZW1iYXJxdWVzOiBbXSwNCiAgICBpdGVtc1Byb2Zvcm1hczogW10sDQogICAgcHJvZm9ybWFJdGVtOiBbXSwNCiAgICBwcm9mb3JtYTogW10sDQogICAgcHJvcGVydGllc1RvTW9kdWxlOiBbDQogICAgICB7DQogICAgICAgIHByb2Zvcm1hSWQ6IG51bGwsDQogICAgICB9LA0KICAgIF0sDQogICAgZGlzcGxheUF1dG9Db21wbGV0ZTogbnVsbCwNCiAgICBsaXN0QXV0b0NvbXBsZXRlOiBbXSwNCiAgICBkaXNwbGF5RXJyb3JUZXh0OiBudWxsLA0KICAgIGRpc3BsYXlFcnJvcjogbnVsbCwNCiAgICBzZXRBdXRvQ29tcGxldGU6IHRydWUsDQogICAgdmFsaWQ6IGZhbHNlLA0KICB9KSwNCg0KICBtZXRob2RzOiB7DQogICAgLi4ubW9kdWxlUHJvZm9ybWFzLm1hcEFjdGlvbnMoew0KICAgICAgZ2V0QWxsOiAnZ2V0QWxsJywNCiAgICAgIGdldEJ5SWQ6ICdnZXRCeUlkJywNCiAgICAgIGdldEFsbE5vdENvbXBsZXRlZDogJ2dldEFsbE5vdENvbXBsZXRlZCcsDQogICAgICBnZXRCb2FyZGluZ0dyb3VwczogJ2dldEJvYXJkaW5nR3JvdXBzJywNCiAgICB9KSwNCiAgICAuLi5tb2R1bGVQYXJhZGFzLm1hcEFjdGlvbnMoew0KICAgICAgdmVyaWZ5UHJvZm9ybWFJbkFub3RoZXJUcmlwOiAndmVyaWZ5UHJvZm9ybWFJbkFub3RoZXJUcmlwJywNCiAgICB9KSwNCg0KICAgIHByb2Zvcm1hQ2hhbmdlZCgpIHsNCiAgICAgIHRoaXMuYm9hcmRpbmdHcm91cCA9IG51bGw7DQogICAgICB0aGlzLmVtYmFycXVlcyA9IFtdOw0KICAgICAgaWYgKHRoaXMucHJvZm9ybWEpDQogICAgICAgIHRoaXMubG9hZEVtYmFycXVlcygpOw0KICAgIH0sDQoNCiAgICBhc3luYyBsb2FkRW1iYXJxdWVzKCkgew0KICAgICAgaWYgKCF0aGlzLnByb2Zvcm1hIHx8IHRoaXMucHJvZm9ybWEubGVuZ3RoID4gMCkNCiAgICAgICAgcmV0dXJuOw0KICAgICAgDQogICAgICB0aGlzLmxvYWRpbmdFbWJhcnF1ZXMgPSB0cnVlOw0KICAgICAgbGV0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZ2V0Qm9hcmRpbmdHcm91cHMoeyBpZDogdGhpcy5wcm9mb3JtYS52YWx1ZSB9KTsNCg0KICAgICAgaWYgKHJlc3VsdCkgew0KICAgICAgICByZXN1bHQuZm9yRWFjaCh4ID0+IHsNCiAgICAgICAgICB0aGlzLmVtYmFycXVlcy5wdXNoKHsNCiAgICAgICAgICAgIHRleHQ6IHguaW52b2ljZSwNCiAgICAgICAgICAgIHZhbHVlOiB4LmlkLA0KICAgICAgICAgIH0pDQogICAgICAgIH0pDQogICAgICB9DQogICAgICANCiAgICAgIHRoaXMubG9hZGluZ0VtYmFycXVlcyA9IGZhbHNlOw0KICAgIH0sDQoNCiAgICBhc3luYyBjYXJyZWdhclByb2Zvcm1hcyhlKSB7DQogICAgICBsZXQgcHJvZm9ybWFzUmVzdWx0ID0gYXdhaXQgdGhpcy5nZXRBbGxOb3RDb21wbGV0ZWQoeyBzZWFyY2g6IGUgfSkNCg0KICAgICAgcmV0dXJuIHByb2Zvcm1hc1Jlc3VsdC5kYXRhLnJlc3VsdC5pdGVtcw0KICAgICAgICA/IHByb2Zvcm1hc1Jlc3VsdC5kYXRhLnJlc3VsdC5pdGVtcy5tYXAoKHgpID0+ICh7DQogICAgICAgICAgICB2YWx1ZTogeC5pZCwNCiAgICAgICAgICAgIHRleHQ6IGAke3gucHJvZm9ybWFWYWx1ZX0gLSAke3guY3VzdG9tZXJOYW1lfWAsDQogICAgICAgICAgfSkpDQogICAgICAgIDogW10NCiAgICB9LA0KDQogICAgY2xvc2VNb2RhbFJlbGF0aW9uU2hpcCgpIHsNCiAgICAgIHRoaXMuZW1iYXJxdWVzID0gW107DQogICAgICB0aGlzLiRlbWl0KCdjbG9zZU1vZGFsUmVsYXRpb25TaGlwJywgZmFsc2UpDQogICAgfSwNCg0KICAgIGFzeW5jIHZlcmlmeUlmRXhpc3RzKHYpIHsNCiAgICAgIGxldCByZXRvcm5vUHJvZm9ybWEgPSBhd2FpdCB0aGlzLnZlcmlmeVByb2Zvcm1hSW5Bbm90aGVyVHJpcCh2KQ0KICAgICAgaWYgKHJldG9ybm9Qcm9mb3JtYS5kYXRhLnJlc3VsdCkgew0KICAgICAgICB0aGlzLmRpc3BsYXlFcnJvciA9IHRydWUNCiAgICAgICAgdGhpcy5kaXNwbGF5RXJyb3JUZXh0ID0NCiAgICAgICAgICAnRXNzYSBwcm9mb3JtYS9lbWJhcnF1ZSBqw6EgZXN0w6EgcmVsYWNpb25hZGEgYSB1bWEgb3V0cmEgcGFyYWRhIGRlc3RhIHZpYWdlbSBvdSBkZSBvdXRyYSB2aWFnZW0uIE7Do28gw6kgcG9zc8OtdmVsIHJlYWxpemFyIG8gcmVsYWNpb25hbWVudG8nDQogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICAgIHRoaXMuZGlzcGxheUVycm9yID0gZmFsc2UNCiAgICAgICAgfSwgNTAwMCkNCiAgICAgICAgcmV0dXJuIHJldG9ybm9Qcm9mb3JtYS5kYXRhLnJlc3VsdA0KICAgICAgfQ0KICAgIH0sDQoNCiAgICBhc3luYyBhZGRJdGVtT25MaXN0KCkgew0KICAgICAgaWYgKCF0aGlzLiRyZWZzLmZvcm0udmFsaWRhdGUoKSkNCiAgICAgICAgcmV0dXJuOw0KDQogICAgICB0aGlzLnByb3BlcnRpZXNUb01vZHVsZSA9IHsNCiAgICAgICAgcHJvZm9ybWFJZDogdGhpcy5wcm9mb3JtYS52YWx1ZSwNCiAgICAgICAgYm9hcmRpbmdHcm91cElkOiB0aGlzLmJvYXJkaW5nR3JvdXAgPyB0aGlzLmJvYXJkaW5nR3JvdXAudmFsdWUgOiBudWxsLA0KICAgICAgfQ0KICAgICAgdmFyIHJldG9ybm9WYWxpZGF0aW9uID0gYXdhaXQgdGhpcy52ZXJpZnlJZkV4aXN0cyh0aGlzLnByb3BlcnRpZXNUb01vZHVsZSkNCiAgICAgIGlmIChyZXRvcm5vVmFsaWRhdGlvbikgcmV0dXJuDQoNCiAgICAgIGxldCBwcm9mb3JtYU9iaiA9IGF3YWl0IHRoaXMuZ2V0QnlJZCh0aGlzLnByb2Zvcm1hLnZhbHVlKQ0KICAgICAgaWYgKHByb2Zvcm1hT2JqKSB7DQogICAgICAgIGlmICh0aGlzLmJvYXJkaW5nR3JvdXApIHsNCiAgICAgICAgICBwcm9mb3JtYU9iai5kYXRhLnJlc3VsdC5ib2FyZGluZ0dyb3VwID0geyANCiAgICAgICAgICAgIGlkOiB0aGlzLmJvYXJkaW5nR3JvdXAudmFsdWUsIA0KICAgICAgICAgICAgaW52b2ljZTogdGhpcy5ib2FyZGluZ0dyb3VwLnRleHQgDQogICAgICAgICAgICB9Ow0KICAgICAgICB9DQogICAgICAgIGVsc2UgDQogICAgICAgICAgcHJvZm9ybWFPYmouZGF0YS5yZXN1bHQuYm9hcmRpbmdHcm91cCA9IG51bGw7DQogICAgICAgICAgDQogICAgICAgIHRoaXMuJGVtaXQoJ3NlbGVjdGVkUHJvZm9ybWEnLCBwcm9mb3JtYU9iai5kYXRhLnJlc3VsdCwgdGhpcy5pbmRleCkNCiAgICAgIH0NCiAgICB9LA0KICB9LA0KICBjb21wdXRlZDogew0KICAgIHRpcG9TaXR1YWNhbygpIHsNCiAgICAgIHJldHVybiB0aGlzLiRzdG9yZS5zdGF0ZS5Nb2R1bGVQYXJhZGFzSW50ZXJtZWRpYXJpYXMudGlwb1NpdHVhY2FvDQogICAgfSwNCiAgfSwNCg0KICB3YXRjaDogew0KICAgIGVycm9yKCkgew0KICAgICAgaWYgKHRoaXMuZXJyb3IpIHsNCiAgICAgICAgdGhpcy5kaXNwbGF5RXJyb3IgPSB0cnVlDQogICAgICAgIHRoaXMuZGlzcGxheUVycm9yVGV4dCA9DQogICAgICAgICAgJ0Vzc2EgcHJvZm9ybWEvZW1iYXJxdWUgasOhIGVzdMOhIHJlbGFjaW9uYSBhIHVtYSBvdXRyYSBwYXJhZGEgZGVzdGEgdmlhZ2VtIG91IGRlIG91dHJhIHZpYWdlbS4gTsOjbyDDqSBwb3Nzw612ZWwgcmVhbGl6YXIgbyByZWxhY2lvbmFtZW50bycNCiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgICAgdGhpcy5kaXNwbGF5RXJyb3IgPSBmYWxzZQ0KICAgICAgICAgIHRoaXMuJGVtaXQoJ3NldEVycm9yJywgZmFsc2UpDQogICAgICAgIH0sIDUwMDApDQogICAgICB9DQogICAgfSwNCiAgICBkaXNwbGF5KCkgew0KICAgICAgdGhpcy5kaXNwbGF5QXV0b0NvbXBsZXRlID0gdGhpcy5kaXNwbGF5Ow0KICAgICAgaWYgKHRoaXMuJHJlZnMuZm9ybSkNCiAgICAgICAgdGhpcy4kcmVmcy5mb3JtLnJlc2V0KCk7DQogICAgICB0aGlzLmVtYmFycXVlcyA9IFtdOw0KICAgIH0sDQogIH0sDQoNCiAgbWl4aW5zOiBbdmFsaWRhdGlvblJ1bGVzXSwNCn0NCg=="},{"version":3,"sources":["modalRelacionarProformas.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA","file":"modalRelacionarProformas.vue","sourceRoot":"src/views/viagensNavios","sourcesContent":["<template>\r\n  <div>\r\n    <v-dialog persistent :value=\"display\" max-width=\"584px\">\r\n      <div class=\"white d-flex px-6 py-3 flex-column\">\r\n        <div class=\"d-flex flex-row justify-space-between\">\r\n          <h2>Relacionar Proforma</h2>\r\n          <v-btn @click=\"closeModalRelationShip\" text small fab>\r\n            <v-icon>mdi-close</v-icon>\r\n          </v-btn>\r\n        </div>\r\n      </div>\r\n      <hr />\r\n      <div class=\"white d-flex pa-6 flex-column\">\r\n        <v-alert\r\n          type=\"error\"\r\n          dense\r\n          class=\"mt-1\"\r\n          outlined\r\n          v-show=\"displayError\"\r\n          transition=\"fade-transition\"\r\n          >{{ displayErrorText }}</v-alert\r\n        >\r\n        <v-form ref=\"form\" v-model=\"valid\">\r\n          <div class=\"mb-12 mt-6\">\r\n            <AutoCompleteFilterAsync\r\n              :searchStore=\"carregarProformas\"\r\n              displayText=\"nome\"\r\n              v-model=\"proforma\"\r\n              hint=\"Busque pelo Número da Proforma ou pela Razão Social\"\r\n              placeholder=\"Digite 3 caracteres\"\r\n              label=\"Proforma\"\r\n              :displayAutoComplete=\"displayAutoComplete\"\r\n              return-object\r\n              @change=\"proformaChanged\"\r\n            />\r\n\r\n            <v-autocomplete\r\n              v-if=\"embarques.length > 0\"\r\n              :rules=\"[rules.required]\"\r\n              class=\"mt-6\"\r\n              clearable\r\n              v-model=\"boardingGroup\"\r\n              :items=\"embarques\"\r\n              :menu-props=\"{ bottom: true, offsetY: true }\"\r\n              :loading=\"loadingEmbarques\"\r\n              hide-selected\r\n              hide-no-data\r\n              return-object\r\n              label=\"Embarque\"\r\n            >\r\n            </v-autocomplete>\r\n          </div>\r\n        </v-form>\r\n      </div>\r\n      <hr />\r\n\r\n      <div class=\"white d-flex pa-2 justify-end\">\r\n        <v-btn\r\n          style=\"height: 40px; width: 132px\"\r\n          rounded\r\n          large\r\n          class=\"asia-red white--text mt-1\"\r\n          @click=\"addItemOnList\"\r\n          >Relacionar</v-btn\r\n        >\r\n      </div>\r\n    </v-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { createNamespacedHelpers } from 'vuex'\r\nimport AutoCompleteFilterAsync from '@/components/AutoCompleteFilterAsync'\r\nimport validationRules from '@/mixins/validationRules.js'\r\n\r\nconst moduleProformas = createNamespacedHelpers('ModuleProformas')\r\nconst moduleParadas = createNamespacedHelpers('ModuleParadasIntermediarias')\r\nexport default {\r\n  props: ['display', 'index', 'error', 'disableButtonRelacionar'],\r\n  components: {\r\n    AutoCompleteFilterAsync,\r\n  },\r\n\r\n  data: () => ({\r\n    loadingEmbarques: false,\r\n    boardingGroup: null,\r\n    embarques: [],\r\n    itemsProformas: [],\r\n    proformaItem: [],\r\n    proforma: [],\r\n    propertiesToModule: [\r\n      {\r\n        proformaId: null,\r\n      },\r\n    ],\r\n    displayAutoComplete: null,\r\n    listAutoComplete: [],\r\n    displayErrorText: null,\r\n    displayError: null,\r\n    setAutoComplete: true,\r\n    valid: false,\r\n  }),\r\n\r\n  methods: {\r\n    ...moduleProformas.mapActions({\r\n      getAll: 'getAll',\r\n      getById: 'getById',\r\n      getAllNotCompleted: 'getAllNotCompleted',\r\n      getBoardingGroups: 'getBoardingGroups',\r\n    }),\r\n    ...moduleParadas.mapActions({\r\n      verifyProformaInAnotherTrip: 'verifyProformaInAnotherTrip',\r\n    }),\r\n\r\n    proformaChanged() {\r\n      this.boardingGroup = null;\r\n      this.embarques = [];\r\n      if (this.proforma)\r\n        this.loadEmbarques();\r\n    },\r\n\r\n    async loadEmbarques() {\r\n      if (!this.proforma || this.proforma.length > 0)\r\n        return;\r\n      \r\n      this.loadingEmbarques = true;\r\n      let result = await this.getBoardingGroups({ id: this.proforma.value });\r\n\r\n      if (result) {\r\n        result.forEach(x => {\r\n          this.embarques.push({\r\n            text: x.invoice,\r\n            value: x.id,\r\n          })\r\n        })\r\n      }\r\n      \r\n      this.loadingEmbarques = false;\r\n    },\r\n\r\n    async carregarProformas(e) {\r\n      let proformasResult = await this.getAllNotCompleted({ search: e })\r\n\r\n      return proformasResult.data.result.items\r\n        ? proformasResult.data.result.items.map((x) => ({\r\n            value: x.id,\r\n            text: `${x.proformaValue} - ${x.customerName}`,\r\n          }))\r\n        : []\r\n    },\r\n\r\n    closeModalRelationShip() {\r\n      this.embarques = [];\r\n      this.$emit('closeModalRelationShip', false)\r\n    },\r\n\r\n    async verifyIfExists(v) {\r\n      let retornoProforma = await this.verifyProformaInAnotherTrip(v)\r\n      if (retornoProforma.data.result) {\r\n        this.displayError = true\r\n        this.displayErrorText =\r\n          'Essa proforma/embarque já está relacionada a uma outra parada desta viagem ou de outra viagem. Não é possível realizar o relacionamento'\r\n        setTimeout(() => {\r\n          this.displayError = false\r\n        }, 5000)\r\n        return retornoProforma.data.result\r\n      }\r\n    },\r\n\r\n    async addItemOnList() {\r\n      if (!this.$refs.form.validate())\r\n        return;\r\n\r\n      this.propertiesToModule = {\r\n        proformaId: this.proforma.value,\r\n        boardingGroupId: this.boardingGroup ? this.boardingGroup.value : null,\r\n      }\r\n      var retornoValidation = await this.verifyIfExists(this.propertiesToModule)\r\n      if (retornoValidation) return\r\n\r\n      let proformaObj = await this.getById(this.proforma.value)\r\n      if (proformaObj) {\r\n        if (this.boardingGroup) {\r\n          proformaObj.data.result.boardingGroup = { \r\n            id: this.boardingGroup.value, \r\n            invoice: this.boardingGroup.text \r\n            };\r\n        }\r\n        else \r\n          proformaObj.data.result.boardingGroup = null;\r\n          \r\n        this.$emit('selectedProforma', proformaObj.data.result, this.index)\r\n      }\r\n    },\r\n  },\r\n  computed: {\r\n    tipoSituacao() {\r\n      return this.$store.state.ModuleParadasIntermediarias.tipoSituacao\r\n    },\r\n  },\r\n\r\n  watch: {\r\n    error() {\r\n      if (this.error) {\r\n        this.displayError = true\r\n        this.displayErrorText =\r\n          'Essa proforma/embarque já está relaciona a uma outra parada desta viagem ou de outra viagem. Não é possível realizar o relacionamento'\r\n        setTimeout(() => {\r\n          this.displayError = false\r\n          this.$emit('setError', false)\r\n        }, 5000)\r\n      }\r\n    },\r\n    display() {\r\n      this.displayAutoComplete = this.display;\r\n      if (this.$refs.form)\r\n        this.$refs.form.reset();\r\n      this.embarques = [];\r\n    },\r\n  },\r\n\r\n  mixins: [validationRules],\r\n}\r\n</script>\r\n"]}]}